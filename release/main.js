/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var st=Object.create;var A=Object.defineProperty;var ot=Object.getOwnPropertyDescriptor;var ct=Object.getOwnPropertyNames;var lt=Object.getPrototypeOf,dt=Object.prototype.hasOwnProperty;var pt=(p,c)=>{for(var t in c)A(p,t,{get:c[t],enumerable:!0})},q=(p,c,t,e)=>{if(c&&typeof c=="object"||typeof c=="function")for(let n of ct(c))!dt.call(p,n)&&n!==t&&A(p,n,{get:()=>c[n],enumerable:!(e=ot(c,n))||e.enumerable});return p};var G=(p,c,t)=>(t=p!=null?st(lt(p)):{},q(c||!p||!p.__esModule?A(t,"default",{value:p,enumerable:!0}):t,p)),ut=p=>q(A({},"__esModule",{value:!0}),p);var ft={};pt(ft,{default:()=>V});module.exports=ut(ft);var b=require("obsidian");var K={contactsFolder:"FriendTracker",defaultSortColumn:"daysUntilBirthday",defaultSortDirection:"asc",relationshipTypes:["family","friend","colleague","pet"],holidayDates:["01-01","07-04","12-25"],defaultActiveTab:"notes",language:"en"};var z=G(require("fs")),Q=G(require("path"));function ht(p){let c=p.split(/\r?\n/),t={};for(let e of c){let n=e.trim();if(!n||n.startsWith(";")||n.startsWith("#")||n.startsWith("["))continue;let a=n.indexOf("=");if(a!==-1){let i=n.slice(0,a).trim(),r=n.slice(a+1).trim();t[i]=r}}return t}async function Z(p){try{let c=await z.promises.readFile(p,"utf8");return ht(c)}catch(c){return console.error("Failed to read translation file",p,c),{}}}function X(p,c){let t=p.vault.adapter.basePath;return Q.join(t,".obsidian","plugins",c.id)}var L=require("obsidian");var J=require("obsidian"),_=class{constructor(c){this.view=c}async render(c,t,e){let n=c.createEl("div",{cls:"friend-tracker-header"});n.createEl("h2",{text:this.view.plugin.t("friend_tracker")});let a=n.createEl("input",{type:"text",cls:"friend-tracker-search-input",placeholder:this.view.plugin.t("search_placeholder")});if(a.value=this.view.searchQuery,a.addEventListener("input",()=>this.view.updateSearchQuery(a.value)),a.addEventListener("focus",()=>{this.view.searchFocused=!0}),a.addEventListener("blur",()=>{this.view.searchFocused=!1}),this.view.searchInput=a,this.view.searchFocused){let l=a.value;a.focus({preventScroll:!0}),a.setSelectionRange(l.length,l.length)}n.createEl("button",{text:this.view.plugin.t("add_contact"),cls:"friend-tracker-button button-outlined"}).addEventListener("click",()=>this.view.openAddContactModal());let r=c.createEl("div",{cls:"friend-tracker-content"});if(t.length===0){r.createEl("div",{cls:"friend-tracker-empty-state"}).createEl("p",{text:this.view.plugin.t("no_contacts")});return}let o=r.createEl("div",{cls:"friend-tracker-table-container"}).createEl("table",{cls:"friend-tracker-table"});this.renderTableHeader(o,e),this.renderTableRows(o,t)}renderTableHeader(c,t){let e=c.createEl("tr");[{key:"name",label:this.view.plugin.t("name"),sortable:!0},{key:"age",label:this.view.plugin.t("age"),sortable:!0},{key:"birthday",label:this.view.plugin.t("birthday"),sortable:!0},{key:"daysUntilBirthday",label:this.view.plugin.t("days_left"),sortable:!0},{key:"relationship",label:this.view.plugin.t("type"),sortable:!0},{key:"lastInteraction",label:this.view.plugin.t("last_interaction"),sortable:!0},{key:"actions",label:"",sortable:!1}].forEach(({key:a,label:i,sortable:r})=>{let s=e.createEl("th");if(r){let o=s.createEl("button",{cls:"friend-tracker-sort-button"});o.createEl("span",{text:i}),o.createEl("span",{cls:"sort-indicator",text:t.column===a?t.direction==="asc"?"\u2191":"\u2193":""}),o.addEventListener("click",()=>{a!=="actions"&&this.view.handleSort(a)})}else s.setText(i)})}renderTableRows(c,t){this.sortContacts(t,this.view.currentSort).forEach(n=>{var o;let a=c.createEl("tr"),i=this.renderNameCell(n);a.appendChild(i),i.addEventListener("click",l=>{l.stopPropagation(),this.view.openContact(n.file)}),a.createEl("td",{text:((o=n.age)==null?void 0:o.toString())||"N/A"}),a.createEl("td",{text:n.formattedBirthday||"N/A"}),a.createEl("td",{text:n.daysUntilBirthday!==null?`${n.daysUntilBirthday} days`:"N/A"}),a.createEl("td",{text:n.relationship||"N/A",cls:"friend-tracker-relationship-cell"}),a.createEl("td",{text:n.lastInteraction||""});let s=a.createEl("td",{cls:"friend-tracker-actions"}).createEl("button",{cls:"friend-tracker-delete-button",attr:{"aria-label":this.view.plugin.t("remove_contact")}});(0,J.setIcon)(s,"trash"),s.addEventListener("click",l=>{l.stopPropagation(),this.view.openDeleteModal(n.file)})})}renderNameCell(c){let t=document.createElement("td");if(t.className="friend-tracker-name-cell",c.daysUntilBirthday!==null)if(c.daysUntilBirthday===0){let e=t.createEl("div",{cls:"table-birthday-indicator birthday-today",text:"\u{1F382}"})}else c.daysUntilBirthday<=7&&t.createEl("div",{cls:"table-birthday-status-dot"}).createEl("div",{cls:"table-birthday-status-dot-inner"});return t.createSpan({text:c.name}),t}sortContacts(c,t){return[...c].sort((e,n)=>{if(t.column==="birthday"){let s=new Date(e.birthday),o=new Date(n.birthday),l=(s.getMonth()+1)*100+s.getDate(),d=(o.getMonth()+1)*100+o.getDate();return t.direction==="asc"?l-d:d-l}if(t.column==="daysUntilBirthday")return e.daysUntilBirthday===null&&n.daysUntilBirthday===null?0:e.daysUntilBirthday===null?1:n.daysUntilBirthday===null?-1:(e.daysUntilBirthday-n.daysUntilBirthday)*(t.direction==="asc"?1:-1);let a=e[t.column],i=n[t.column];if(!a&&!i)return 0;if(!a)return 1;if(!i)return-1;let r=t.direction==="asc"?1:-1;if(t.column==="relationship"||t.column==="name"){let s=String(a).toLowerCase(),o=String(i).toLowerCase();return s<o?-r:s>o?r:0}else if(typeof a=="number"&&typeof i=="number")return(a-i)*r;return a<i?-r:a>i?r:0})}};var D=require("obsidian"),S=class{constructor(c){this.plugin=c}async getContacts(){var i;let c=this.plugin.settings.contactsFolder,t=this.plugin.app.vault,e=t.getFolderByPath(c);if(!e)return new D.Notice("Colaborador Tracker folder not found."),[];let n=e.children.filter(r=>r instanceof D.TFile),a=[];for(let r of n)if(r instanceof D.TFile)try{let o=(await t.read(r)).match(/^---\n([\s\S]*?)\n---/);if(o){let l=(0,D.parseYaml)(o[1]),d=((i=l.interactions)==null?void 0:i.length)>0?this.formatDaysAgo(l.interactions[0].date):null;a.push({name:l.name||"Unknown",birthday:l.birthday||"",formattedBirthday:this.formatBirthday(l.birthday),relationship:l.relationship||"",age:this.calculateAge(l.birthday),daysUntilBirthday:this.calculateDaysUntilBirthday(l.birthday),lastInteraction:d,file:r})}}catch(s){console.error(`Error reading contact file ${r.path}:`,s)}return a}calculateAge(c){if(!c)return null;let[t,e,n]=c.split("-").map(Number),a=new Date(t,e-1,n);if(a.setHours(0,0,0,0),isNaN(a.getTime()))return null;let i=new Date;i.setHours(0,0,0,0);let r=i.getFullYear()-a.getFullYear(),s=i.getMonth()-a.getMonth();return(s<0||s===0&&i.getDate()<a.getDate())&&r--,r}calculateDetailedAge(c){if(!c)return"";let[t,e,n]=c.split("-").map(Number),a=new Date(t,e-1,n);if(a.setHours(0,0,0,0),isNaN(a.getTime()))return"";let i=new Date;i.setHours(0,0,0,0);let r=i.getFullYear()-a.getFullYear(),s=i.getMonth()-a.getMonth(),o=i.getDate()-a.getDate();if(o<0){s--;let d=new Date(i.getFullYear(),i.getMonth(),0);o+=d.getDate()}s<0&&(r--,s+=12);let l=[];return r>0&&l.push(`${r} ${r===1?"year":"years"}`),s>0&&l.push(`${s} ${s===1?"month":"months"}`),o>0&&l.push(`${o} ${o===1?"day":"days"}`),l.join(", ")+" old"}formatBirthday(c){if(!c)return"";let[t,e,n]=c.split("-").map(Number),a=new Date(t,e-1,n);return a.setHours(0,0,0,0),isNaN(a.getTime())?c:a.toLocaleDateString("en-US",{month:"long",day:"numeric"})}calculateDaysUntilBirthday(c){if(!c)return null;let[t,e,n]=c.split("-").map(Number),a=new Date(t,e-1,n);if(a.setHours(0,0,0,0),isNaN(a.getTime()))return null;let i=new Date;i.setHours(0,0,0,0);let r=new Date(i.getFullYear(),a.getMonth(),a.getDate());if(r.setHours(0,0,0,0),r<i&&r.setFullYear(i.getFullYear()+1),i.getDay()===1){let u=new Date(i);u.setDate(i.getDate()-2);let f=new Date(i);if(f.setDate(i.getDate()-1),u.getMonth()===a.getMonth()&&u.getDate()===a.getDate()||f.getMonth()===a.getMonth()&&f.getDate()===a.getDate())return 0}let s=new Date(i);s.setDate(i.getDate()-1);let o=u=>`${String(u.getMonth()+1).padStart(2,"0")}-${String(u.getDate()).padStart(2,"0")}`;if(new Set(this.plugin.settings.holidayDates).has(o(s))&&o(s)===`${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`)return 0;let d=r.getTime()-i.getTime();return Math.round(d/(1e3*60*60*24))}formatDaysAgo(c){let t=new Date(c),n=new Date().getTime()-t.getTime();return`${Math.floor(n/(1e3*60*60*24))} days`}};var m=require("obsidian");var g={NAME:"name",BIRTHDAY:"birthday",EMAIL:"email",PHONE:"phone",ADDRESS:"address",RELATIONSHIP:"relationship",INTERACTIONS:"interactions",CREATED:"created",UPDATED:"updated",NOTES:"notes",EXTRAS:"extras"},U=[g.NAME,g.INTERACTIONS,g.CREATED,g.UPDATED,g.NOTES,g.EXTRAS],bt={[g.BIRTHDAY]:"date",[g.PHONE]:"tel",[g.EMAIL]:"email"};function $(p,c,t="",e){let n=p.createEl("input",{cls:"friend-tracker-modal-input",attr:{type:"text",value:t||"",placeholder:c.t("relationship_placeholder"),list:"relationship-types",autocomplete:"on",role:"combobox","aria-autocomplete":"list"}}),a=document.getElementById("relationship-types");a||(a=document.createElement("datalist"),a.id="relationship-types",document.body.appendChild(a));let i=r=>{a.empty(),c.settings.relationshipTypes.filter(o=>!r||o.includes(r.toLowerCase())).forEach(o=>{let l=a.createEl("option");l.text=o.charAt(0).toUpperCase()+o.slice(1)})};return i(),n.addEventListener("input",()=>{i(n.value)}),e&&n.addEventListener("change",()=>{e(n.value)}),n}var M=class{constructor(c){this.view=c}createRelationshipField(c,t){let e=$(c,this.view.plugin,t,async n=>{let a=n.toLowerCase();if(await this.view.updateContactData(g.RELATIONSHIP,a),a&&!this.view.getRelationshipTypes().includes(a)){let i=this.view.getRelationshipTypes().filter(r=>r.toLowerCase()!==a);await this.view.addRelationshipType(a,i)}});e.className="contact-field-input"}createInfoField(c,t,e){let n=c.createEl("div",{cls:"contact-field"});n.createEl("label",{text:t}),t.toLowerCase()===g.BIRTHDAY?this.createBirthdayField(n,e):t.toLowerCase()===g.PHONE?this.createPhoneField(n,e):t.toLowerCase()===g.RELATIONSHIP?this.createRelationshipField(n,e):this.createTextField(n,t,e)}createBirthdayField(c,t){let e=c.createEl("input",{cls:"contact-field-input",attr:{type:"date",value:t||"",placeholder:"YYYY-MM-DD",pattern:"\\d{4}-\\d{2}-\\d{2}"}});e.addEventListener("change",async()=>{if(!this.view.file)return;let n=e.value;await this.view.updateContactData("birthday",n)})}createPhoneField(c,t){let e=c.createEl("input",{cls:"contact-field-input",attr:{type:"tel",value:t||"",placeholder:"+1234567890",pattern:"^[0-9+\\-]*$"}});e.addEventListener("input",n=>{let a=n.target;a.value=a.value.replace(/[^0-9+-]/g,"")}),e.addEventListener("change",async()=>{await this.view.updateContactData("phone",e.value)})}createTextField(c,t,e){let n=c.createEl("input",{cls:"contact-field-input",attr:{type:"text",value:e||"",placeholder:this.view.plugin.t("not_set")}});n.addEventListener("change",async()=>{await this.view.updateContactData(t.toLowerCase(),n.value)})}};var Y=require("obsidian"),B=class{constructor(c){this.view=c}render(c,t){let e=c.createEl("div",{cls:"contact-interactions-list"});[...t].sort((a,i)=>new Date(i.date).getTime()-new Date(a.date).getTime()).forEach((a,i)=>{this.createInteractionItem(e,a,i)})}createInteractionItem(c,t,e){let n=c.createEl("div",{cls:"contact-interaction-item"}),[a,i,r]=t.date.split("-").map(Number),o=new Date(a,i-1,r).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"});n.createEl("div",{cls:"contact-interaction-date",text:o}),n.createEl("div",{cls:"contact-interaction-text",text:t.text});let l=n.createEl("div",{cls:"contact-interaction-actions"}),d=l.createEl("button",{cls:"friend-tracker-button button-icon",attr:{"aria-label":"Edit interaction"}});(0,Y.setIcon)(d,"pencil"),d.addEventListener("click",()=>{this.view.openEditInteractionModal(e,t)});let u=l.createEl("button",{cls:"friend-tracker-button button-icon button-danger",attr:{"aria-label":"Delete interaction"}});(0,Y.setIcon)(u,"trash"),u.addEventListener("click",()=>{this.view.deleteInteraction(e)})}};var tt=require("obsidian"),N=class extends tt.Modal{constructor(t,e,n){super(t);this.plugin=e,this.onSubmit=n}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:this.plugin.t("add_custom_field")});let e=t.createEl("form");e.addEventListener("submit",a=>{a.preventDefault();let i=e.querySelector("input");i!=null&&i.value&&(this.onSubmit(i.value.toLowerCase()),this.close())}),e.createEl("input",{attr:{type:"text",placeholder:this.plugin.t("field_name_placeholder"),pattern:"[a-zA-Z][a-zA-Z0-9]*"},cls:"contact-field-input"}).focus(),e.createEl("button",{text:this.plugin.t("add_field"),attr:{type:"submit"},cls:"friend-tracker-button button-primary button-full-width"})}onClose(){let{contentEl:t}=this;t.empty()}};var et=require("obsidian"),x=class extends et.Modal{constructor(t,e,n){super(t);this.interaction=e,this.onSubmit=n}onOpen(){var i,r;let{contentEl:t}=this;t.empty();let e=this.app.plugins.getPlugin("friend-tracker");t.createEl("h2",{text:this.interaction?(e==null?void 0:e.t("edit_interaction"))||"Edit interaction":(e==null?void 0:e.t("add_interaction"))||"Add interaction"});let n=t.createEl("form");n.addEventListener("submit",s=>{s.preventDefault();let o=n.querySelector("[type=date]"),l=n.querySelector("textarea");o!=null&&o.value&&(l!=null&&l.value)&&(this.onSubmit(o.value,l.value),this.close())}),n.createEl("input",{attr:{type:"date",value:((i=this.interaction)==null?void 0:i.date)||new Date().toISOString().split("T")[0],required:"true"},cls:"contact-interaction-date-input"});let a=n.createEl("textarea",{attr:{placeholder:(e==null?void 0:e.t("what_happened"))||"What happened?",required:"true"},cls:"contact-interaction-text-input"});a.value=((r=this.interaction)==null?void 0:r.text)||"",n.createEl("button",{text:this.interaction?(e==null?void 0:e.t("save_changes"))||"Save changes":(e==null?void 0:e.t("add_interaction"))||"Add interaction",attr:{type:"submit"},cls:"friend-tracker-button button-primary"})}onClose(){let{contentEl:t}=this;t.empty()}};var C="contact-page-view",R=class extends m.ItemView{constructor(t,e){super(t);this._plugin=e;this._file=null;this.contactData={};this.plugin=e,this.contactFields=new M(this),this.interactionView=new B(this),this.activeTab=this.plugin.settings.defaultActiveTab}getRelationshipTypes(){return this.plugin.settings.relationshipTypes}async addRelationshipType(t,e){this.plugin.settings.relationshipTypes=[...e||this.plugin.settings.relationshipTypes,t],await this.plugin.saveSettings()}getViewType(){return C}getDisplayText(){var t;return((t=this._file)==null?void 0:t.basename)||"Contact"}get file(){return this._file}async setState(t,e){let n=this.app.vault.getFileByPath(t.filePath);n&&await this.setFile(n),await super.setState(t,e)}getState(){var t;return{type:C,filePath:(t=this._file)==null?void 0:t.path}}async setFile(t){var n,a;this._file=t;let e=t.path;try{let i=await this.app.vault.read(t);if(((n=this._file)==null?void 0:n.path)!==e)return;let r=i.match(/^---\n([\s\S]*?)\n---/);this.contactData=r?(0,m.parseYaml)(r[1]):{}}catch(i){console.error(`Error reading contact file ${t.path}:`,i),this.contactData={}}((a=this._file)==null?void 0:a.path)===e&&this.render()}render(){let t=this.containerEl.children[1];if(t.empty(),!this.contactData||!this.contactData.name){t.createEl("div",{text:this.plugin.t("no_contact_data"),cls:"contact-empty-state"});return}let n=t.createEl("div",{cls:"contact-page-header"}).createEl("div",{cls:"contact-name-container"});this.renderNameSection(n);let a=t.createEl("div",{cls:"contact-info-section"});this.renderInfoSection(a);let i=t.createEl("div",{cls:"contact-tabs"});[{id:"notes",icon:"pencil",label:this.plugin.t("notes")},{id:"interactions",icon:"clock",label:this.plugin.t("interactions")},{id:"markdown",icon:"document",label:this.plugin.t("markdown")}].forEach(o=>{let l=i.createEl("button",{cls:`contact-tab ${this.activeTab===o.id?"active":""}`});(0,m.setIcon)(l,o.icon),l.createSpan({text:o.label}),l.addEventListener("click",async()=>{this.activeTab=o.id,this.plugin.settings.defaultActiveTab=o.id,await this.plugin.saveSettings(),this.render()})});let s=t.createEl("div",{cls:"contact-content"});switch(this.activeTab){case"notes":this.renderNotesSection(s);break;case"interactions":this.renderInteractionsSection(s);break;case"markdown":this.renderExtrasSection(s);break}}renderNameSection(t){let n=t.createEl("div",{cls:"contact-name-section"}).createEl("div",{cls:"contact-name-display"}),a=n.createEl("div",{cls:"contact-name-row"}),i=a.createEl("h1",{text:this.contactData.name||this.plugin.t("unnamed_contact")}),r=a.createEl("input",{type:"text",value:this.contactData.name||"",placeholder:this.plugin.t("contact_name_placeholder"),cls:"contact-name-input"}),s=a.createEl("button",{cls:"friend-tracker-button button-icon contact-name-edit"});if((0,m.setIcon)(s,"pencil"),this.contactData.birthday){let l=this.plugin.contactOperations.calculateDetailedAge(this.contactData.birthday);n.createEl("span",{text:l,cls:"contact-age-display"});let[d,u,f]=this.contactData.birthday.split("-").map(Number),h=["Rat","Ox","Tiger","Rabbit","Dragon","Snake","Horse","Goat","Monkey","Rooster","Dog","Pig"][(d-4)%12],v=this.getZodiacSign(u,f),W=this.getSeason(u,f),it=this.getBirthstone(u);n.createEl("span",{text:`${v} \u2022 Year of the ${h}`,cls:"contact-age-display"}),n.createEl("span",{text:`${W} baby \u2022 Birthstone: ${it}`,cls:"contact-age-display"});let k=this.calculateDaysUntilBirthday(this.contactData.birthday);if(k!==null){let I=n.createEl("div",{cls:"contact-birthday-countdown"});if(k===0)I.createEl("div",{cls:"table-birthday-indicator birthday-today",text:"\u{1F382}"}),I.createSpan({text:"Birthday today!"});else{k<=7&&I.createEl("div",{cls:"birthday-status-dot"}).createEl("div",{cls:"birthday-status-dot-inner"});let rt=k===1?"Birthday tomorrow!":`${k} days until birthday`;I.createSpan({text:rt})}}}s.addEventListener("click",()=>{r.classList.contains("editing")?o():(i.classList.add("editing"),r.classList.add("editing"),(0,m.setIcon)(s,"checkmark"),r.focus())});let o=async()=>{if(!this._file)return;let l=r.value.trim();if(l&&(this.contactData.name=r.value,await this.saveContactData(),this._file.parent)){let d=`${this._file.parent.path}/${l}.md`;try{await this.app.fileManager.renameFile(this._file,d),new m.Notice(this.plugin.t("updated_contact_name"));let u=this.app.workspace.getLeavesOfType(w);for(let f of u){let T=await f.view;if(T instanceof E){await T.refresh();break}}}catch(u){new m.Notice(this.plugin.t("error_updating_filename")+": "+u)}}i.textContent=r.value||this.plugin.t("unnamed_contact"),i.classList.remove("editing"),r.classList.remove("editing"),(0,m.setIcon)(s,"pencil")};r.addEventListener("change",o)}calculateDetailedAge(t){let e=new Date(t+"T00:00:00Z"),n=new Date,a=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate())),i=a.getUTCFullYear()-e.getUTCFullYear(),r=a.getUTCMonth()-e.getUTCMonth(),s=a.getUTCDate()-e.getUTCDate();if(s<0){r--;let o=new Date(Date.UTC(a.getFullYear(),a.getMonth(),0));s+=o.getUTCDate()}return r<0&&(i--,r+=12),s===0?`${i} years, ${r} months old`:`${i} years, ${r} months, ${s} days old`}calculateDaysUntilBirthday(t){return this.plugin.contactOperations.calculateDaysUntilBirthday(t)}getZodiacSign(t,e){return t===3&&e>=21||t===4&&e<=19?"Aries":t===4&&e>=20||t===5&&e<=20?"Taurus":t===5&&e>=21||t===6&&e<=20?"Gemini":t===6&&e>=21||t===7&&e<=22?"Cancer":t===7&&e>=23||t===8&&e<=22?"Leo":t===8&&e>=23||t===9&&e<=22?"Virgo":t===9&&e>=23||t===10&&e<=22?"Libra":t===10&&e>=23||t===11&&e<=21?"Scorpio":t===11&&e>=22||t===12&&e<=21?"Sagittarius":t===12&&e>=22||t===1&&e<=19?"Capricorn":t===1&&e>=20||t===2&&e<=18?"Aquarius":"Pisces"}getSeason(t,e){return t===3&&e>=20||t===4||t===5||t===6&&e<21?"Spring":t===6&&e>=21||t===7||t===8||t===9&&e<22?"Summer":t===9&&e>=22||t===10||t===11||t===12&&e<21?"Autumn":"Winter"}getBirthstone(t){return{1:"Garnet",2:"Amethyst",3:"Aquamarine",4:"Diamond",5:"Emerald",6:"Pearl",7:"Ruby",8:"Peridot",9:"Sapphire",10:"Opal",11:"Topaz",12:"Turquoise"}[t]||"Unknown"}renderInfoSection(t){let n=t.createEl("div",{cls:"contact-info-section"}).createEl("div",{cls:"contact-fields-container"}),a=()=>{n.empty(),n.classList.remove("editing"),Object.entries(this.contactData).filter(([s])=>!["name","notes","interactions","created","updated"].includes(s)).forEach(([s,o])=>{if(!o)return;let l=n.createEl("div",{cls:"contact-field-view",attr:{"data-field":s.toLowerCase()}});l.createEl("div",{cls:"contact-field-label",text:s});let d=s==="birthday"&&o?(()=>{let[u,f,T]=o.split("-").map(Number),h=new Date(u,f-1,T);return h.setHours(0,0,0,0),h.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})():o;l.createEl("div",{cls:"contact-field-value",text:d})}),n.createEl("button",{cls:"friend-tracker-button",text:this.plugin.t("edit")}).addEventListener("click",()=>{i()})},i=()=>{n.empty(),n.classList.add("editing"),Object.values(g).filter(l=>!U.includes(l)).forEach(l=>{this.createInfoField(n,l,this.contactData[l])});let r=[...U,...Object.values(g).map(l=>l.toLowerCase()),"created","updated"];Object.entries(this.contactData).filter(([l])=>!r.includes(l.toLowerCase())).forEach(([l,d])=>{this.createInfoField(n,l,d)}),n.createEl("button",{cls:"friend-tracker-button button-outlined",text:this.plugin.t("add_custom_field")}).addEventListener("click",()=>{this.openAddFieldModal()}),n.createEl("button",{cls:"friend-tracker-button button-primary button-full-width",text:this.plugin.t("done")}).addEventListener("click",async()=>{await this.saveContactData(),a()})};a()}createInfoField(t,e,n){let a=t.createEl("div",{cls:"contact-field"});a.createEl("label",{text:e});let i=a.createEl("input",{cls:"contact-field-input",attr:{type:e==="birthday"?"date":"text",placeholder:`Enter ${e.toLowerCase()}`,value:n||"",...e==="relationship"&&{list:"relationship-types"}}});i.addEventListener("change",()=>{this.updateContactData(e,i.value)})}renderNotesSection(t){let n=t.createEl("div",{cls:"contact-notes-section"}).createEl("textarea",{cls:"contact-notes-input",attr:{placeholder:this.plugin.t("notes_placeholder")}});n.value=this.contactData.notes||"",n.addEventListener("input",()=>{this.adjustTextareaHeight(n)}),setTimeout(()=>{this.adjustTextareaHeight(n)},0),n.addEventListener("change",async()=>{this._file&&(this.contactData.notes=n.value,await this.saveContactData())})}renderInteractionsSection(t){let e=t.createEl("div",{cls:"contact-interactions"}),n=e.createEl("div",{cls:"contact-interactions-header"});(!Array.isArray(this.contactData.interactions)||this.contactData.interactions.length===0)&&n.createEl("div",{cls:"section-helper-text",text:this.plugin.t("log_touchpoints_help")}),n.createEl("button",{cls:"friend-tracker-button button-align-right",text:this.plugin.t("add_interaction")}).addEventListener("click",()=>{this.openAddInteractionModal()}),Array.isArray(this.contactData.interactions)&&this.interactionView.render(e,this.contactData.interactions)}async renderExtrasSection(t){let e=t.createEl("div",{cls:"contact-extras-section"});if(!this._file)return;let n=e.createEl("div",{cls:"contact-extras-header"});((await this.app.vault.read(this._file)).split(/^---\n([\s\S]*?)\n---/).pop()||"").trim()||n.createEl("div",{cls:"section-helper-text",text:this.plugin.t("add_markdown_help")}),n.createEl("button",{cls:"friend-tracker-button button-align-right",text:this.plugin.t("edit_markdown")}).addEventListener("click",()=>{var s;this.app.workspace.openLinkText(((s=this._file)==null?void 0:s.path)||"","",!0)});try{let o=(await this.app.vault.read(this._file)).split(/^---\n([\s\S]*?)\n---/).pop()||"";if(o.trim()){let l=e.createEl("div",{cls:"contact-extras-content"});await m.MarkdownRenderer.renderMarkdown(o,l,this._file.path,this),l.addEventListener("click",d=>{var f;let u=d.target;if(u.tagName==="A"){let h=u.getAttribute("href");if(h!=null&&h.startsWith("#")){d.preventDefault();let v=l.querySelector(h);v==null||v.scrollIntoView()}else h!=null&&h.startsWith("http")||(d.preventDefault(),this.app.workspace.openLinkText(h||"",((f=this._file)==null?void 0:f.path)||"",d.ctrlKey||d.metaKey))}})}}catch(s){console.error(`Error reading extras from file ${this._file.path}:`,s)}}adjustTextareaHeight(t){t.classList.add("measuring"),t.style.setProperty("--scroll-height",`${t.scrollHeight}px`),t.classList.remove("measuring")}async saveContactData(){this._file&&(this.contactData.interactions&&this.contactData.interactions.sort((t,e)=>new Date(e.date).getTime()-new Date(t.date).getTime()),await this.app.fileManager.processFrontMatter(this._file,t=>{Object.assign(t,this.contactData)}))}async openAddFieldModal(){new N(this.app,this.plugin,async e=>{this.contactData[e]?new m.Notice("Field already exists!"):(this.contactData[e]="",await this.saveContactData(),this.render())}).open()}async openAddInteractionModal(){new x(this.app,null,async(e,n)=>{Array.isArray(this.contactData.interactions)||(this.contactData.interactions=[]),this.contactData.interactions.push({date:e,text:n}),await this.saveContactData(),this.render()}).open()}async openEditInteractionModal(t,e){new x(this.app,e,async(a,i)=>{Array.isArray(this.contactData.interactions)||(this.contactData.interactions=[]),this.contactData.interactions[t]={date:a,text:i},await this.saveContactData(),this.render()}).open()}async deleteInteraction(t){this.contactData.interactions.splice(t,1),await this.saveContactData(),this.render()}async updateContactData(t,e){this.contactData[t]=e,await this.saveContactData()}};var F=require("obsidian"),nt=require("obsidian");var O=class extends F.Modal{constructor(t,e){super(t);this.plugin=e}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:this.plugin.t("add_new_contact")});let e=t.createEl("form",{cls:"friend-tracker-add-contact-form"}),n=e.createDiv({cls:"friend-tracker-modal-field"});n.createEl("label",{text:this.plugin.t("name_required")});let a=n.createEl("input",{attr:{type:"text",name:"name",required:!0,placeholder:this.plugin.t("contact_name_placeholder")},cls:"friend-tracker-modal-input"});a.focus();let i=e.createDiv({cls:"friend-tracker-modal-field"});i.createEl("label",{text:this.plugin.t("birthday")});let r=i.createEl("input",{attr:{type:"date",name:"birthday",placeholder:this.plugin.t("birthday_placeholder"),pattern:"\\d{4}-\\d{2}-\\d{2}"},cls:"friend-tracker-modal-input"}),s=e.createDiv({cls:"friend-tracker-modal-field"});s.createEl("label",{text:this.plugin.t("email")});let o=s.createEl("input",{attr:{type:"email",name:"email",placeholder:this.plugin.t("email_placeholder")},cls:"friend-tracker-modal-input"}),l=e.createDiv({cls:"friend-tracker-modal-field"});l.createEl("label",{text:this.plugin.t("phone")});let d=l.createEl("input",{attr:{type:"tel",name:"phone",placeholder:this.plugin.t("phone_placeholder")},cls:"friend-tracker-modal-input"}),u=e.createDiv({cls:"friend-tracker-modal-field"});u.createEl("label",{text:this.plugin.t("relationship")});let f=$(u,this.plugin);e.createEl("button",{text:this.plugin.t("create_contact"),attr:{type:"submit"},cls:"friend-tracker-button button-primary"}),e.addEventListener("submit",T=>{T.preventDefault();let h={name:a.value};if(r.value&&(h.birthday=r.value),o.value&&(h.email=o.value),d.value&&(h.phone=d.value),f.value){let v=f.value.toLowerCase();h.relationship=f.value.toLowerCase(),this.plugin.settings.relationshipTypes.includes(v)||(this.plugin.settings.relationshipTypes=[...new Set(this.plugin.settings.relationshipTypes.filter(W=>W.toLowerCase()!==v)),v],this.plugin.saveSettings())}h.name&&(this.onSubmit(h),this.close())})}async onSubmit(t){let e=`${t.name}.md`,n=`${this.plugin.settings.contactsFolder}/${e}`,a=this.plugin.settings.contactsFolder;this.app.vault.getFolderByPath(a)||await this.app.vault.createFolder(a);let r=`---
${(0,nt.stringifyYaml)(t)}
---
`;try{await this.app.vault.create(n,r),await new Promise(o=>setTimeout(o,300));let s=this.app.workspace.getLeavesOfType(w);for(let o of s){let l=o.view;if(l instanceof E){await l.refresh();break}}new F.Notice(this.plugin.t("created_contact")+": "+t.name)}catch(s){new F.Notice(this.plugin.t("error_creating_contact")+": "+s)}}onClose(){let{contentEl:t}=this;t.empty()}};var at=require("obsidian"),P=class extends at.Modal{constructor(t,e,n){super(t);this.file=e;this.onDelete=n}onOpen(){var r;let{contentEl:t}=this;t.empty();let e=this.app.plugins.getPlugin("friend-tracker");t.createEl("h2",{text:(e==null?void 0:e.t("delete_contact"))||"Delete contact"}),t.createEl("p",{text:((r=e==null?void 0:e.t("delete_confirm"))==null?void 0:r.replace("{name}",this.file.basename))||`Are you sure you want to delete ${this.file.basename}?`});let n=t.createEl("div",{cls:"friend-tracker-modal-buttons"});n.createEl("button",{text:(e==null?void 0:e.t("cancel"))||"Cancel",cls:"friend-tracker-modal-button"}).addEventListener("click",()=>this.close()),n.createEl("button",{text:(e==null?void 0:e.t("delete"))||"Delete",cls:"friend-tracker-modal-button friend-tracker-modal-button-danger"}).addEventListener("click",async()=>{await this.onDelete(),this.close()})}onClose(){let{contentEl:t}=this;t.empty()}};var w="friend-tracker-view",E=class extends L.ItemView{constructor(t,e){super(t);this.plugin=e;this.fileChangeHandler=null;this.isRefreshing=!1;this._contacts=null;this.searchQuery="";this.searchFocused=!1;this.searchInput=null;this.handleVisibilityChange=()=>{document.visibilityState==="visible"&&this.refresh()};this.handleWindowFocus=()=>{this.refresh()};this.currentSort={column:this.plugin.settings.defaultSortColumn,direction:this.plugin.settings.defaultSortDirection},this.tableView=new _(this),this.contactOps=new S(this.plugin)}async openAddContactModal(){new O(this.app,this.plugin).open()}handleSort(t){this.currentSort.column===t?this.currentSort.direction=this.currentSort.direction==="asc"?"desc":"asc":this.currentSort={column:t,direction:"asc"},this.refresh()}async openContact(t){let e=this.app.workspace.getLeavesOfType(C),n=e.length>0?e[0]:this.app.workspace.getLeaf("tab");await n.setViewState({type:C,state:{filePath:t.path}}),this.app.workspace.setActiveLeaf(n,{focus:!0}),this.app.workspace.revealLeaf(n),L.Platform.isMobile&&this.app.workspace.rightSplit.collapse()}async openDeleteModal(t){new P(this.app,t,async()=>{await this.app.fileManager.trashFile(t),await this.refresh()}).open()}updateSearchQuery(t){this.searchQuery=t,this.refresh()}getViewType(){return w}getDisplayText(){return"Colaborador Tracker"}async onOpen(){this.registerEvent(this.app.vault.on("modify",t=>{t instanceof L.TFile&&this.isContactFile(t)&&setTimeout(()=>this.refresh(),100)})),document.addEventListener("visibilitychange",this.handleVisibilityChange),window.addEventListener("focus",this.handleWindowFocus),await this.refresh()}onunload(){document.removeEventListener("visibilitychange",this.handleVisibilityChange),window.removeEventListener("focus",this.handleWindowFocus)}async refresh(){if(!this.isRefreshing){this.isRefreshing=!0;try{this._contacts=null;let t=this.containerEl.children[1];for(;t.firstChild;)t.removeChild(t.firstChild);let e=await this.contactOps.getContacts(),n=this.filterContacts(e),a=this.currentSort.column&&this.currentSort.direction?this.currentSort:{column:"name",direction:"asc"},i=n.sort((s,o)=>{let l=s[a.column],d=o[a.column];return l===null&&d===null?0:l===null?a.direction==="asc"?-1:1:d===null?a.direction==="asc"?1:-1:l<d?a.direction==="asc"?-1:1:l>d?a.direction==="asc"?1:-1:0}),r=t.createDiv();if(await this.tableView.render(r,i,a),this.searchFocused&&this.searchInput){let s=this.searchInput.value;this.searchInput.focus({preventScroll:!0}),this.searchInput.setSelectionRange(s.length,s.length)}}finally{this.isRefreshing=!1}}}isContactFile(t){let e=this.plugin.settings.contactsFolder;return t.path.startsWith(e+"/")}async sortContacts(t,e){this.currentSort={column:t,direction:e},await this.refresh()}filterContacts(t){if(!this.searchQuery)return t;let e=this.searchQuery.toLowerCase();return t.filter(n=>n.name.toLowerCase().includes(e))}};var y=require("obsidian"),j=class extends y.AbstractInputSuggest{constructor(t,e){super(t,e);this.inputEl=e}getSuggestions(t){return this.app.vault.getAllLoadedFiles().filter(n=>n instanceof y.TFolder).map(n=>n.path).filter(n=>n.toLowerCase().includes(t.toLowerCase()))}renderSuggestion(t,e){e.setText(t)}selectSuggestion(t){this.inputEl.value=t,this.inputEl.trigger("input"),this.close()}},H=class extends y.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty();let e=[{value:"name",label:"Name"},{value:"age",label:"Age"},{value:"birthday",label:"Birthday"},{value:"daysUntilBirthday",label:"Days until birthday"},{value:"relationship",label:"Relationship"},{value:"lastInteraction",label:"Last interaction"}];new y.Setting(t).setName("Contacts folder").setDesc("Folder where contact files will be stored").addText(i=>(new j(this.app,i.inputEl),i.setPlaceholder("Enter folder name").setValue(this.plugin.settings.contactsFolder).onChange(async r=>{this.plugin.settings.contactsFolder=(0,y.normalizePath)(r),await this.plugin.saveSettings()}))),new y.Setting(t).setName("Default sort").setDesc("Choose how contacts are sorted by default").addDropdown(i=>(e.forEach(({value:r,label:s})=>{i.addOption(r,s)}),i.setValue(this.plugin.settings.defaultSortColumn).onChange(async r=>{this.plugin.settings.defaultSortColumn=r,await this.plugin.saveSettings()}))).addDropdown(i=>{i.addOption("asc","Ascending").addOption("desc","Descending").setValue(this.plugin.settings.defaultSortDirection).onChange(async r=>{this.plugin.settings.defaultSortDirection=r,await this.plugin.saveSettings()})});let n=t.createEl("div",{cls:"friend-tracker-relationship-header"});n.createEl("h3",{text:"Relationship types"}),new y.Setting(n).addButton(i=>i.setButtonText("Add relationship type").onClick(async()=>{let r=document.createElement("input");r.type="text",r.placeholder="Enter relationship type",r.className="friend-tracker-modal-input relationship-type-input",i.buttonEl.replaceWith(r),r.focus();let s=async()=>{let l=(r.value||"").trim();if(l){let d=l.toLowerCase();this.plugin.settings.relationshipTypes.includes(d)||(this.plugin.settings.relationshipTypes.push(d),await this.plugin.saveSettings())}setTimeout(()=>this.display(),0)};r.addEventListener("keydown",async o=>{o.key==="Enter"?(o.preventDefault(),await s()):o.key==="Escape"&&this.display()}),r.addEventListener("blur",async()=>{var o;(o=r.value)!=null&&o.trim()?await s():this.display()})}));let a=t.createEl("div",{cls:"friend-tracker-relationship-types"});this.plugin.settings.relationshipTypes.forEach(i=>{new y.Setting(a).addText(r=>r.setValue(i).setPlaceholder("Type name").then(s=>{s.inputEl.addEventListener("keypress",async o=>{o.key==="Enter"&&(o.preventDefault(),s.inputEl.blur())}),s.inputEl.addEventListener("blur",async()=>{let o=s.inputEl.value,l=this.plugin.settings.relationshipTypes.indexOf(i);if(o.toLowerCase()!==i||o!==o.toLowerCase()){let d=o.toLowerCase();this.plugin.settings.relationshipTypes=[...this.plugin.settings.relationshipTypes.filter((u,f)=>f===l||u.toLowerCase()!==d)],this.plugin.settings.relationshipTypes[l]=d,await this.plugin.saveSettings(),setTimeout(()=>this.display(),0)}})})).addExtraButton(r=>{r.setIcon("trash").setTooltip("Delete relationship type").onClick(async()=>{let s=this.plugin.settings.relationshipTypes.indexOf(i);this.plugin.settings.relationshipTypes.splice(s,1),await this.plugin.saveSettings(),this.display()})})}),new y.Setting(t).setName("Default tab").setDesc("Choose which tab opens by default").addDropdown(i=>{i.addOption("notes","Notes").addOption("interactions","Interactions").addOption("markdown","Markdown").setValue(this.plugin.settings.defaultActiveTab).onChange(async r=>{this.plugin.settings.defaultActiveTab=r,await this.plugin.saveSettings()})}),new y.Setting(t).setName("Language").setDesc("Select plugin language").addDropdown(i=>{i.addOption("en","English").addOption("pt","Portugu\xEAs").addOption("zh","\u4E2D\u6587").addOption("ja","\u65E5\u672C\u8A9E").setValue(this.plugin.settings.language).onChange(async r=>{this.plugin.settings.language=r,await this.plugin.saveSettings(),await this.plugin.loadTranslations(),this.display()})})}};var V=class extends b.Plugin{constructor(){super(...arguments);this.translations={}}t(t){return this.translations[t]||t}async onload(){await this.loadSettings(),await this.loadTranslations(),this.contactOperations=new S(this),this.app.workspace.onLayoutReady(()=>{this.initialize()})}async initialize(){try{this.registerView(w,t=>new E(t,this)),this.registerView(C,t=>new R(t,this)),this.addRibbonIcon("user","Open Colaborador Tracker",async()=>{let t=this.app.workspace,e=t.getLeavesOfType(w);for(let a of e)if(await a.view instanceof E){t.revealLeaf(a);return}let n=t.getRightLeaf(!1);n?(await n.setViewState({type:w,active:!0}),t.revealLeaf(n)):new b.Notice("Could not create Colaborador Tracker view")}),this.addSettingTab(new H(this.app,this)),await this.checkBirthdays()}catch(t){console.error("Colaborador Tracker failed to load:",t),new b.Notice("Colaborador Tracker failed to load: "+t.message)}}async checkBirthdays(){let t=await this.contactOperations.getContacts(),e=t.filter(a=>a.daysUntilBirthday===0);if(e.length>0)if(e.length===1)new b.Notice(`\u{1F382} It's ${e[0].name}'s birthday today!`,8e3);else{let a=e.map(s=>s.name),i=a.pop(),r=a.join(", ")+" and "+i;new b.Notice(`\u{1F382} It's ${r}'s birthday today!`,8e3)}let n=t.filter(a=>a.daysUntilBirthday===1);if(n.length>0)if(n.length===1)new b.Notice(`\u{1F388} ${n[0].name}'s birthday is tomorrow!`,6e3);else{let a=n.map(s=>s.name),i=a.pop(),r=a.join(", ")+" and "+i;new b.Notice(`\u{1F388} ${r}'s birthdays are tomorrow!`,6e3)}}async loadTranslations(){try{let e=`${X(this.app,this.manifest)}/locales/${this.settings.language}.ini`;this.translations=await Z(e)}catch(t){console.error("Failed to load translations",t),this.translations={}}}async loadSettings(){this.settings=Object.assign({},K,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async onunload(){let t=document.getElementById("relationship-types");t&&t.remove()}};
