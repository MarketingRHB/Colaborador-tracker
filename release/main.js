/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var ot=Object.create;var _=Object.defineProperty;var st=Object.getOwnPropertyDescriptor;var ct=Object.getOwnPropertyNames;var lt=Object.getPrototypeOf,dt=Object.prototype.hasOwnProperty;var pt=(p,c)=>{for(var t in c)_(p,t,{get:c[t],enumerable:!0})},q=(p,c,t,e)=>{if(c&&typeof c=="object"||typeof c=="function")for(let a of ct(c))!dt.call(p,a)&&a!==t&&_(p,a,{get:()=>c[a],enumerable:!(e=st(c,a))||e.enumerable});return p};var G=(p,c,t)=>(t=p!=null?ot(lt(p)):{},q(c||!p||!p.__esModule?_(t,"default",{value:p,enumerable:!0}):t,p)),ut=p=>q(_({},"__esModule",{value:!0}),p);var gt={};pt(gt,{default:()=>V});module.exports=ut(gt);var E=require("obsidian");var K={contactsFolder:"CollaboratorTracker",defaultSortColumn:"daysUntilBirthday",defaultSortDirection:"asc",relationshipTypes:["family","collaborator","colleague","pet"],holidayDates:["01-01","07-04","12-25"],defaultActiveTab:"notes",language:"en"};var z=G(require("fs")),Q=G(require("path"));function ht(p){let c=p.split(/\r?\n/),t={};for(let e of c){let a=e.trim();if(!a||a.startsWith(";")||a.startsWith("#")||a.startsWith("["))continue;let n=a.indexOf("=");if(n!==-1){let i=a.slice(0,n).trim(),r=a.slice(n+1).trim();t[i]=r}}return t}async function Z(p){try{let c=await z.promises.readFile(p,"utf8");return ht(c)}catch(c){return console.error("Failed to read translation file",p,c),{}}}function X(p,c){let t=p.vault.adapter.basePath;return Q.join(t,".obsidian","plugins",c.id)}var L=require("obsidian");var J=require("obsidian"),F=class{constructor(c){this.view=c}async render(c,t,e){let a=c.createEl("div",{cls:"collaborator-tracker-header"});a.createEl("h2",{text:this.view.plugin.t("collaborator_tracker")});let n=a.createEl("input",{type:"text",cls:"collaborator-tracker-search-input",placeholder:this.view.plugin.t("search_placeholder")});if(n.value=this.view.searchQuery,n.addEventListener("input",()=>this.view.updateSearchQuery(n.value)),n.addEventListener("focus",()=>{this.view.searchFocused=!0}),n.addEventListener("blur",()=>{this.view.searchFocused=!1}),this.view.searchInput=n,this.view.searchFocused){let l=n.value;n.focus({preventScroll:!0}),n.setSelectionRange(l.length,l.length)}a.createEl("button",{text:this.view.plugin.t("add_contact"),cls:"collaborator-tracker-button button-outlined"}).addEventListener("click",()=>this.view.openAddContactModal());let r=c.createEl("div",{cls:"collaborator-tracker-content"});if(t.length===0){r.createEl("div",{cls:"collaborator-tracker-empty-state"}).createEl("p",{text:this.view.plugin.t("no_contacts")});return}let s=r.createEl("div",{cls:"collaborator-tracker-table-container"}).createEl("table",{cls:"collaborator-tracker-table"});this.renderTableHeader(s,e),this.renderTableRows(s,t)}renderTableHeader(c,t){let e=c.createEl("tr");[{key:"name",label:this.view.plugin.t("name"),sortable:!0},{key:"age",label:this.view.plugin.t("age"),sortable:!0},{key:"birthday",label:this.view.plugin.t("birthday"),sortable:!0},{key:"daysUntilBirthday",label:this.view.plugin.t("days_left"),sortable:!0},{key:"relationship",label:this.view.plugin.t("type"),sortable:!0},{key:"lastInteraction",label:this.view.plugin.t("last_interaction"),sortable:!0},{key:"actions",label:"",sortable:!1}].forEach(({key:n,label:i,sortable:r})=>{let o=e.createEl("th");if(r){let s=o.createEl("button",{cls:"collaborator-tracker-sort-button"});s.createEl("span",{text:i}),s.createEl("span",{cls:"sort-indicator",text:t.column===n?t.direction==="asc"?"\u2191":"\u2193":""}),s.addEventListener("click",()=>{n!=="actions"&&this.view.handleSort(n)})}else o.setText(i)})}renderTableRows(c,t){this.sortContacts(t,this.view.currentSort).forEach(a=>{var s;let n=c.createEl("tr"),i=this.renderNameCell(a);n.appendChild(i),i.addEventListener("click",l=>{l.stopPropagation(),this.view.openContact(a.file)}),n.createEl("td",{text:((s=a.age)==null?void 0:s.toString())||"N/A"}),n.createEl("td",{text:a.formattedBirthday||"N/A"}),n.createEl("td",{text:a.daysUntilBirthday!==null?`${a.daysUntilBirthday} days`:"N/A"}),n.createEl("td",{text:a.relationship||"N/A",cls:"collaborator-tracker-relationship-cell"}),n.createEl("td",{text:a.lastInteraction||""});let o=n.createEl("td",{cls:"collaborator-tracker-actions"}).createEl("button",{cls:"collaborator-tracker-delete-button",attr:{"aria-label":this.view.plugin.t("remove_contact")}});(0,J.setIcon)(o,"trash"),o.addEventListener("click",l=>{l.stopPropagation(),this.view.openDeleteModal(a.file)})})}renderNameCell(c){let t=document.createElement("td");if(t.className="collaborator-tracker-name-cell",c.daysUntilBirthday!==null)if(c.daysUntilBirthday===0){let e=t.createEl("div",{cls:"table-birthday-indicator birthday-today",text:"\u{1F382}"})}else c.daysUntilBirthday<=7&&t.createEl("div",{cls:"table-birthday-status-dot"}).createEl("div",{cls:"table-birthday-status-dot-inner"});return t.createSpan({text:c.name}),t}sortContacts(c,t){return[...c].sort((e,a)=>{if(t.column==="birthday"){let o=new Date(e.birthday),s=new Date(a.birthday),l=(o.getMonth()+1)*100+o.getDate(),d=(s.getMonth()+1)*100+s.getDate();return t.direction==="asc"?l-d:d-l}if(t.column==="daysUntilBirthday")return e.daysUntilBirthday===null&&a.daysUntilBirthday===null?0:e.daysUntilBirthday===null?1:a.daysUntilBirthday===null?-1:(e.daysUntilBirthday-a.daysUntilBirthday)*(t.direction==="asc"?1:-1);let n=e[t.column],i=a[t.column];if(!n&&!i)return 0;if(!n)return 1;if(!i)return-1;let r=t.direction==="asc"?1:-1;if(t.column==="relationship"||t.column==="name"){let o=String(n).toLowerCase(),s=String(i).toLowerCase();return o<s?-r:o>s?r:0}else if(typeof n=="number"&&typeof i=="number")return(n-i)*r;return n<i?-r:n>i?r:0})}};var T=require("obsidian"),S=class{constructor(c){this.plugin=c}async getContacts(){var i;let c=this.plugin.settings.contactsFolder,t=this.plugin.app.vault,e=t.getFolderByPath(c);if(!e)return new T.Notice("Collaborator Tracker folder not found."),[];let a=e.children.filter(r=>r instanceof T.TFile),n=[];for(let r of a)if(r instanceof T.TFile)try{let s=(await t.read(r)).match(/^---\n([\s\S]*?)\n---/);if(s){let l=(0,T.parseYaml)(s[1]),d=((i=l.interactions)==null?void 0:i.length)>0?this.formatDaysAgo(l.interactions[0].date):null;n.push({name:l.name||"Unknown",birthday:l.birthday||"",formattedBirthday:this.formatBirthday(l.birthday),relationship:l.relationship||"",age:this.calculateAge(l.birthday),daysUntilBirthday:this.calculateDaysUntilBirthday(l.birthday),lastInteraction:d,file:r})}}catch(o){console.error(`Error reading contact file ${r.path}:`,o)}return n}calculateAge(c){if(!c)return null;let[t,e,a]=c.split("-").map(Number),n=new Date(t,e-1,a);if(n.setHours(0,0,0,0),isNaN(n.getTime()))return null;let i=new Date;i.setHours(0,0,0,0);let r=i.getFullYear()-n.getFullYear(),o=i.getMonth()-n.getMonth();return(o<0||o===0&&i.getDate()<n.getDate())&&r--,r}calculateDetailedAge(c){if(!c)return"";let[t,e,a]=c.split("-").map(Number),n=new Date(t,e-1,a);if(n.setHours(0,0,0,0),isNaN(n.getTime()))return"";let i=new Date;i.setHours(0,0,0,0);let r=i.getFullYear()-n.getFullYear(),o=i.getMonth()-n.getMonth(),s=i.getDate()-n.getDate();if(s<0){o--;let d=new Date(i.getFullYear(),i.getMonth(),0);s+=d.getDate()}o<0&&(r--,o+=12);let l=[];return r>0&&l.push(`${r} ${r===1?"year":"years"}`),o>0&&l.push(`${o} ${o===1?"month":"months"}`),s>0&&l.push(`${s} ${s===1?"day":"days"}`),l.join(", ")+" old"}formatBirthday(c){if(!c)return"";let[t,e,a]=c.split("-").map(Number),n=new Date(t,e-1,a);return n.setHours(0,0,0,0),isNaN(n.getTime())?c:n.toLocaleDateString("en-US",{month:"long",day:"numeric"})}calculateDaysUntilBirthday(c){if(!c)return null;let[t,e,a]=c.split("-").map(Number),n=new Date(t,e-1,a);if(n.setHours(0,0,0,0),isNaN(n.getTime()))return null;let i=new Date;i.setHours(0,0,0,0);let r=new Date(i.getFullYear(),n.getMonth(),n.getDate());if(r.setHours(0,0,0,0),r<i&&r.setFullYear(i.getFullYear()+1),i.getDay()===1){let u=new Date(i);u.setDate(i.getDate()-2);let g=new Date(i);if(g.setDate(i.getDate()-1),u.getMonth()===n.getMonth()&&u.getDate()===n.getDate()||g.getMonth()===n.getMonth()&&g.getDate()===n.getDate())return 0}let o=new Date(i);o.setDate(i.getDate()-1);let s=u=>`${String(u.getMonth()+1).padStart(2,"0")}-${String(u.getDate()).padStart(2,"0")}`;if(new Set(this.plugin.settings.holidayDates).has(s(o))&&s(o)===`${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`)return 0;let d=r.getTime()-i.getTime();return Math.round(d/(1e3*60*60*24))}formatDaysAgo(c){let t=new Date(c),a=new Date().getTime()-t.getTime();return`${Math.floor(a/(1e3*60*60*24))} days`}};var m=require("obsidian");var f={NAME:"name",BIRTHDAY:"birthday",EMAIL:"email",PHONE:"phone",ADDRESS:"address",RELATIONSHIP:"relationship",INTERACTIONS:"interactions",CREATED:"created",UPDATED:"updated",NOTES:"notes",EXTRAS:"extras"},U=[f.NAME,f.INTERACTIONS,f.CREATED,f.UPDATED,f.NOTES,f.EXTRAS],Et={[f.BIRTHDAY]:"date",[f.PHONE]:"tel",[f.EMAIL]:"email"};function $(p,c,t="",e){let a=p.createEl("input",{cls:"collaborator-tracker-modal-input",attr:{type:"text",value:t||"",placeholder:c.t("relationship_placeholder"),list:"relationship-types",autocomplete:"on",role:"combobox","aria-autocomplete":"list"}}),n=document.getElementById("relationship-types");n||(n=document.createElement("datalist"),n.id="relationship-types",document.body.appendChild(n));let i=r=>{n.empty(),c.settings.relationshipTypes.filter(s=>!r||s.includes(r.toLowerCase())).forEach(s=>{let l=n.createEl("option");l.text=s.charAt(0).toUpperCase()+s.slice(1)})};return i(),a.addEventListener("input",()=>{i(a.value)}),e&&a.addEventListener("change",()=>{e(a.value)}),a}var M=class{constructor(c){this.view=c}createRelationshipField(c,t){let e=$(c,this.view.plugin,t,async a=>{let n=a.toLowerCase();if(await this.view.updateContactData(f.RELATIONSHIP,n),n&&!this.view.getRelationshipTypes().includes(n)){let i=this.view.getRelationshipTypes().filter(r=>r.toLowerCase()!==n);await this.view.addRelationshipType(n,i)}});e.className="contact-field-input"}createInfoField(c,t,e){let a=c.createEl("div",{cls:"contact-field"});a.createEl("label",{text:t}),t.toLowerCase()===f.BIRTHDAY?this.createBirthdayField(a,e):t.toLowerCase()===f.PHONE?this.createPhoneField(a,e):t.toLowerCase()===f.RELATIONSHIP?this.createRelationshipField(a,e):this.createTextField(a,t,e)}createBirthdayField(c,t){let e=c.createEl("input",{cls:"contact-field-input",attr:{type:"date",value:t||"",placeholder:"YYYY-MM-DD",pattern:"\\d{4}-\\d{2}-\\d{2}"}});e.addEventListener("change",async()=>{if(!this.view.file)return;let a=e.value;await this.view.updateContactData("birthday",a)})}createPhoneField(c,t){let e=c.createEl("input",{cls:"contact-field-input",attr:{type:"tel",value:t||"",placeholder:"+1234567890",pattern:"^[0-9+\\-]*$"}});e.addEventListener("input",a=>{let n=a.target;n.value=n.value.replace(/[^0-9+-]/g,"")}),e.addEventListener("change",async()=>{await this.view.updateContactData("phone",e.value)})}createTextField(c,t,e){let a=c.createEl("input",{cls:"contact-field-input",attr:{type:"text",value:e||"",placeholder:this.view.plugin.t("not_set")}});a.addEventListener("change",async()=>{await this.view.updateContactData(t.toLowerCase(),a.value)})}};var Y=require("obsidian"),B=class{constructor(c){this.view=c}render(c,t){let e=c.createEl("div",{cls:"contact-interactions-list"});[...t].sort((n,i)=>new Date(i.date).getTime()-new Date(n.date).getTime()).forEach((n,i)=>{this.createInteractionItem(e,n,i)})}createInteractionItem(c,t,e){let a=c.createEl("div",{cls:"contact-interaction-item"}),[n,i,r]=t.date.split("-").map(Number),s=new Date(n,i-1,r).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"});a.createEl("div",{cls:"contact-interaction-date",text:s}),a.createEl("div",{cls:"contact-interaction-text",text:t.text});let l=a.createEl("div",{cls:"contact-interaction-actions"}),d=l.createEl("button",{cls:"collaborator-tracker-button button-icon",attr:{"aria-label":"Edit interaction"}});(0,Y.setIcon)(d,"pencil"),d.addEventListener("click",()=>{this.view.openEditInteractionModal(e,t)});let u=l.createEl("button",{cls:"collaborator-tracker-button button-icon button-danger",attr:{"aria-label":"Delete interaction"}});(0,Y.setIcon)(u,"trash"),u.addEventListener("click",()=>{this.view.deleteInteraction(e)})}};var tt=require("obsidian"),O=class extends tt.Modal{constructor(t,e,a){super(t);this.plugin=e,this.onSubmit=a}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:this.plugin.t("add_custom_field")});let e=t.createEl("form");e.addEventListener("submit",n=>{n.preventDefault();let i=e.querySelector("input");i!=null&&i.value&&(this.onSubmit(i.value.toLowerCase()),this.close())}),e.createEl("input",{attr:{type:"text",placeholder:this.plugin.t("field_name_placeholder"),pattern:"[a-zA-Z][a-zA-Z0-9]*"},cls:"contact-field-input"}).focus(),e.createEl("button",{text:this.plugin.t("add_field"),attr:{type:"submit"},cls:"collaborator-tracker-button button-primary button-full-width"})}onClose(){let{contentEl:t}=this;t.empty()}};var et=require("obsidian"),x=class extends et.Modal{constructor(t,e,a){super(t);this.interaction=e,this.onSubmit=a}onOpen(){var i,r;let{contentEl:t}=this;t.empty();let e=this.app.plugins.getPlugin("collaborator-tracker");t.createEl("h2",{text:this.interaction?(e==null?void 0:e.t("edit_interaction"))||"Edit interaction":(e==null?void 0:e.t("add_interaction"))||"Add interaction"});let a=t.createEl("form");a.addEventListener("submit",o=>{o.preventDefault();let s=a.querySelector("[type=date]"),l=a.querySelector("textarea");s!=null&&s.value&&(l!=null&&l.value)&&(this.onSubmit(s.value,l.value),this.close())}),a.createEl("input",{attr:{type:"date",value:((i=this.interaction)==null?void 0:i.date)||new Date().toISOString().split("T")[0],required:"true"},cls:"contact-interaction-date-input"});let n=a.createEl("textarea",{attr:{placeholder:(e==null?void 0:e.t("what_happened"))||"What happened?",required:"true"},cls:"contact-interaction-text-input"});n.value=((r=this.interaction)==null?void 0:r.text)||"",a.createEl("button",{text:this.interaction?(e==null?void 0:e.t("save_changes"))||"Save changes":(e==null?void 0:e.t("add_interaction"))||"Add interaction",attr:{type:"submit"},cls:"collaborator-tracker-button button-primary"})}onClose(){let{contentEl:t}=this;t.empty()}};var D="contact-page-view",R=class extends m.ItemView{constructor(t,e){super(t);this._plugin=e;this._file=null;this.contactData={};this.plugin=e,this.contactFields=new M(this),this.interactionView=new B(this),this.activeTab=this.plugin.settings.defaultActiveTab}getRelationshipTypes(){return this.plugin.settings.relationshipTypes}async addRelationshipType(t,e){this.plugin.settings.relationshipTypes=[...e||this.plugin.settings.relationshipTypes,t],await this.plugin.saveSettings()}getViewType(){return D}getDisplayText(){var t;return((t=this._file)==null?void 0:t.basename)||"Contact"}get file(){return this._file}async setState(t,e){let a=this.app.vault.getFileByPath(t.filePath);a&&await this.setFile(a),await super.setState(t,e)}getState(){var t;return{type:D,filePath:(t=this._file)==null?void 0:t.path}}async setFile(t){var a,n;this._file=t;let e=t.path;try{let i=await this.app.vault.read(t);if(((a=this._file)==null?void 0:a.path)!==e)return;let r=i.match(/^---\n([\s\S]*?)\n---/);this.contactData=r?(0,m.parseYaml)(r[1]):{}}catch(i){console.error(`Error reading contact file ${t.path}:`,i),this.contactData={}}((n=this._file)==null?void 0:n.path)===e&&this.render()}render(){let t=this.containerEl.children[1];if(t.empty(),!this.contactData||!this.contactData.name){t.createEl("div",{text:this.plugin.t("no_contact_data"),cls:"contact-empty-state"});return}let a=t.createEl("div",{cls:"contact-page-header"}).createEl("div",{cls:"contact-name-container"});this.renderNameSection(a);let n=t.createEl("div",{cls:"contact-info-section"});this.renderInfoSection(n);let i=t.createEl("div",{cls:"contact-tabs"});[{id:"notes",icon:"pencil",label:this.plugin.t("notes")},{id:"interactions",icon:"clock",label:this.plugin.t("interactions")},{id:"markdown",icon:"document",label:this.plugin.t("markdown")}].forEach(s=>{let l=i.createEl("button",{cls:`contact-tab ${this.activeTab===s.id?"active":""}`});(0,m.setIcon)(l,s.icon),l.createSpan({text:s.label}),l.addEventListener("click",async()=>{this.activeTab=s.id,this.plugin.settings.defaultActiveTab=s.id,await this.plugin.saveSettings(),this.render()})});let o=t.createEl("div",{cls:"contact-content"});switch(this.activeTab){case"notes":this.renderNotesSection(o);break;case"interactions":this.renderInteractionsSection(o);break;case"markdown":this.renderExtrasSection(o);break}}renderNameSection(t){let a=t.createEl("div",{cls:"contact-name-section"}).createEl("div",{cls:"contact-name-display"}),n=a.createEl("div",{cls:"contact-name-row"}),i=n.createEl("h1",{text:this.contactData.name||this.plugin.t("unnamed_contact")}),r=n.createEl("input",{type:"text",value:this.contactData.name||"",placeholder:this.plugin.t("contact_name_placeholder"),cls:"contact-name-input"}),o=n.createEl("button",{cls:"collaborator-tracker-button button-icon contact-name-edit"});if((0,m.setIcon)(o,"pencil"),this.contactData.birthday){let l=this.plugin.contactOperations.calculateDetailedAge(this.contactData.birthday);a.createEl("span",{text:l,cls:"contact-age-display"});let[d,u,g]=this.contactData.birthday.split("-").map(Number),h=["Rat","Ox","Tiger","Rabbit","Dragon","Snake","Horse","Goat","Monkey","Rooster","Dog","Pig"][(d-4)%12],b=this.getZodiacSign(u,g),W=this.getSeason(u,g),it=this.getBirthstone(u);a.createEl("span",{text:`${b} \u2022 Year of the ${h}`,cls:"contact-age-display"}),a.createEl("span",{text:`${W} baby \u2022 Birthstone: ${it}`,cls:"contact-age-display"});let k=this.calculateDaysUntilBirthday(this.contactData.birthday);if(k!==null){let I=a.createEl("div",{cls:"contact-birthday-countdown"});if(k===0)I.createEl("div",{cls:"table-birthday-indicator birthday-today",text:"\u{1F382}"}),I.createSpan({text:"Birthday today!"});else{k<=7&&I.createEl("div",{cls:"birthday-status-dot"}).createEl("div",{cls:"birthday-status-dot-inner"});let rt=k===1?"Birthday tomorrow!":`${k} days until birthday`;I.createSpan({text:rt})}}}o.addEventListener("click",()=>{r.classList.contains("editing")?s():(i.classList.add("editing"),r.classList.add("editing"),(0,m.setIcon)(o,"checkmark"),r.focus())});let s=async()=>{if(!this._file)return;let l=r.value.trim();if(l&&(this.contactData.name=r.value,await this.saveContactData(),this._file.parent)){let d=`${this._file.parent.path}/${l}.md`;try{await this.app.fileManager.renameFile(this._file,d),new m.Notice(this.plugin.t("updated_contact_name"));let u=this.app.workspace.getLeavesOfType(v);for(let g of u){let C=await g.view;if(C instanceof w){await C.refresh();break}}}catch(u){new m.Notice(this.plugin.t("error_updating_filename")+": "+u)}}i.textContent=r.value||this.plugin.t("unnamed_contact"),i.classList.remove("editing"),r.classList.remove("editing"),(0,m.setIcon)(o,"pencil")};r.addEventListener("change",s)}calculateDetailedAge(t){let e=new Date(t+"T00:00:00Z"),a=new Date,n=new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate())),i=n.getUTCFullYear()-e.getUTCFullYear(),r=n.getUTCMonth()-e.getUTCMonth(),o=n.getUTCDate()-e.getUTCDate();if(o<0){r--;let s=new Date(Date.UTC(n.getFullYear(),n.getMonth(),0));o+=s.getUTCDate()}return r<0&&(i--,r+=12),o===0?`${i} years, ${r} months old`:`${i} years, ${r} months, ${o} days old`}calculateDaysUntilBirthday(t){return this.plugin.contactOperations.calculateDaysUntilBirthday(t)}getZodiacSign(t,e){return t===3&&e>=21||t===4&&e<=19?"Aries":t===4&&e>=20||t===5&&e<=20?"Taurus":t===5&&e>=21||t===6&&e<=20?"Gemini":t===6&&e>=21||t===7&&e<=22?"Cancer":t===7&&e>=23||t===8&&e<=22?"Leo":t===8&&e>=23||t===9&&e<=22?"Virgo":t===9&&e>=23||t===10&&e<=22?"Libra":t===10&&e>=23||t===11&&e<=21?"Scorpio":t===11&&e>=22||t===12&&e<=21?"Sagittarius":t===12&&e>=22||t===1&&e<=19?"Capricorn":t===1&&e>=20||t===2&&e<=18?"Aquarius":"Pisces"}getSeason(t,e){return t===3&&e>=20||t===4||t===5||t===6&&e<21?"Spring":t===6&&e>=21||t===7||t===8||t===9&&e<22?"Summer":t===9&&e>=22||t===10||t===11||t===12&&e<21?"Autumn":"Winter"}getBirthstone(t){return{1:"Garnet",2:"Amethyst",3:"Aquamarine",4:"Diamond",5:"Emerald",6:"Pearl",7:"Ruby",8:"Peridot",9:"Sapphire",10:"Opal",11:"Topaz",12:"Turquoise"}[t]||"Unknown"}renderInfoSection(t){let a=t.createEl("div",{cls:"contact-info-section"}).createEl("div",{cls:"contact-fields-container"}),n=()=>{a.empty(),a.classList.remove("editing"),Object.entries(this.contactData).filter(([o])=>!["name","notes","interactions","created","updated"].includes(o)).forEach(([o,s])=>{if(!s)return;let l=a.createEl("div",{cls:"contact-field-view",attr:{"data-field":o.toLowerCase()}});l.createEl("div",{cls:"contact-field-label",text:o});let d=o==="birthday"&&s?(()=>{let[u,g,C]=s.split("-").map(Number),h=new Date(u,g-1,C);return h.setHours(0,0,0,0),h.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})():s;l.createEl("div",{cls:"contact-field-value",text:d})}),a.createEl("button",{cls:"collaborator-tracker-button",text:this.plugin.t("edit")}).addEventListener("click",()=>{i()})},i=()=>{a.empty(),a.classList.add("editing"),Object.values(f).filter(l=>!U.includes(l)).forEach(l=>{this.createInfoField(a,l,this.contactData[l])});let r=[...U,...Object.values(f).map(l=>l.toLowerCase()),"created","updated"];Object.entries(this.contactData).filter(([l])=>!r.includes(l.toLowerCase())).forEach(([l,d])=>{this.createInfoField(a,l,d)}),a.createEl("button",{cls:"collaborator-tracker-button button-outlined",text:this.plugin.t("add_custom_field")}).addEventListener("click",()=>{this.openAddFieldModal()}),a.createEl("button",{cls:"collaborator-tracker-button button-primary button-full-width",text:this.plugin.t("done")}).addEventListener("click",async()=>{await this.saveContactData(),n()})};n()}createInfoField(t,e,a){let n=t.createEl("div",{cls:"contact-field"});n.createEl("label",{text:e});let i=n.createEl("input",{cls:"contact-field-input",attr:{type:e==="birthday"?"date":"text",placeholder:`Enter ${e.toLowerCase()}`,value:a||"",...e==="relationship"&&{list:"relationship-types"}}});i.addEventListener("change",()=>{this.updateContactData(e,i.value)})}renderNotesSection(t){let a=t.createEl("div",{cls:"contact-notes-section"}).createEl("textarea",{cls:"contact-notes-input",attr:{placeholder:this.plugin.t("notes_placeholder")}});a.value=this.contactData.notes||"",a.addEventListener("input",()=>{this.adjustTextareaHeight(a)}),setTimeout(()=>{this.adjustTextareaHeight(a)},0),a.addEventListener("change",async()=>{this._file&&(this.contactData.notes=a.value,await this.saveContactData())})}renderInteractionsSection(t){let e=t.createEl("div",{cls:"contact-interactions"}),a=e.createEl("div",{cls:"contact-interactions-header"});(!Array.isArray(this.contactData.interactions)||this.contactData.interactions.length===0)&&a.createEl("div",{cls:"section-helper-text",text:this.plugin.t("log_touchpoints_help")}),a.createEl("button",{cls:"collaborator-tracker-button button-align-right",text:this.plugin.t("add_interaction")}).addEventListener("click",()=>{this.openAddInteractionModal()}),Array.isArray(this.contactData.interactions)&&this.interactionView.render(e,this.contactData.interactions)}async renderExtrasSection(t){let e=t.createEl("div",{cls:"contact-extras-section"});if(!this._file)return;let a=e.createEl("div",{cls:"contact-extras-header"});((await this.app.vault.read(this._file)).split(/^---\n([\s\S]*?)\n---/).pop()||"").trim()||a.createEl("div",{cls:"section-helper-text",text:this.plugin.t("add_markdown_help")}),a.createEl("button",{cls:"collaborator-tracker-button button-align-right",text:this.plugin.t("edit_markdown")}).addEventListener("click",()=>{var o;this.app.workspace.openLinkText(((o=this._file)==null?void 0:o.path)||"","",!0)});try{let s=(await this.app.vault.read(this._file)).split(/^---\n([\s\S]*?)\n---/).pop()||"";if(s.trim()){let l=e.createEl("div",{cls:"contact-extras-content"});await m.MarkdownRenderer.renderMarkdown(s,l,this._file.path,this),l.addEventListener("click",d=>{var g;let u=d.target;if(u.tagName==="A"){let h=u.getAttribute("href");if(h!=null&&h.startsWith("#")){d.preventDefault();let b=l.querySelector(h);b==null||b.scrollIntoView()}else h!=null&&h.startsWith("http")||(d.preventDefault(),this.app.workspace.openLinkText(h||"",((g=this._file)==null?void 0:g.path)||"",d.ctrlKey||d.metaKey))}})}}catch(o){console.error(`Error reading extras from file ${this._file.path}:`,o)}}adjustTextareaHeight(t){t.classList.add("measuring"),t.style.setProperty("--scroll-height",`${t.scrollHeight}px`),t.classList.remove("measuring")}async saveContactData(){this._file&&(this.contactData.interactions&&this.contactData.interactions.sort((t,e)=>new Date(e.date).getTime()-new Date(t.date).getTime()),await this.app.fileManager.processFrontMatter(this._file,t=>{Object.assign(t,this.contactData)}))}async openAddFieldModal(){new O(this.app,this.plugin,async e=>{this.contactData[e]?new m.Notice("Field already exists!"):(this.contactData[e]="",await this.saveContactData(),this.render())}).open()}async openAddInteractionModal(){new x(this.app,null,async(e,a)=>{Array.isArray(this.contactData.interactions)||(this.contactData.interactions=[]),this.contactData.interactions.push({date:e,text:a}),await this.saveContactData(),this.render()}).open()}async openEditInteractionModal(t,e){new x(this.app,e,async(n,i)=>{Array.isArray(this.contactData.interactions)||(this.contactData.interactions=[]),this.contactData.interactions[t]={date:n,text:i},await this.saveContactData(),this.render()}).open()}async deleteInteraction(t){this.contactData.interactions.splice(t,1),await this.saveContactData(),this.render()}async updateContactData(t,e){this.contactData[t]=e,await this.saveContactData()}};var A=require("obsidian"),at=require("obsidian");var N=class extends A.Modal{constructor(t,e){super(t);this.plugin=e}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:this.plugin.t("add_new_contact")});let e=t.createEl("form",{cls:"collaborator-tracker-add-contact-form"}),a=e.createDiv({cls:"collaborator-tracker-modal-field"});a.createEl("label",{text:this.plugin.t("name_required")});let n=a.createEl("input",{attr:{type:"text",name:"name",required:!0,placeholder:this.plugin.t("contact_name_placeholder")},cls:"collaborator-tracker-modal-input"});n.focus();let i=e.createDiv({cls:"collaborator-tracker-modal-field"});i.createEl("label",{text:this.plugin.t("birthday")});let r=i.createEl("input",{attr:{type:"date",name:"birthday",placeholder:this.plugin.t("birthday_placeholder"),pattern:"\\d{4}-\\d{2}-\\d{2}"},cls:"collaborator-tracker-modal-input"}),o=e.createDiv({cls:"collaborator-tracker-modal-field"});o.createEl("label",{text:this.plugin.t("email")});let s=o.createEl("input",{attr:{type:"email",name:"email",placeholder:this.plugin.t("email_placeholder")},cls:"collaborator-tracker-modal-input"}),l=e.createDiv({cls:"collaborator-tracker-modal-field"});l.createEl("label",{text:this.plugin.t("phone")});let d=l.createEl("input",{attr:{type:"tel",name:"phone",placeholder:this.plugin.t("phone_placeholder")},cls:"collaborator-tracker-modal-input"}),u=e.createDiv({cls:"collaborator-tracker-modal-field"});u.createEl("label",{text:this.plugin.t("relationship")});let g=$(u,this.plugin);e.createEl("button",{text:this.plugin.t("create_contact"),attr:{type:"submit"},cls:"collaborator-tracker-button button-primary"}),e.addEventListener("submit",C=>{C.preventDefault();let h={name:n.value};if(r.value&&(h.birthday=r.value),s.value&&(h.email=s.value),d.value&&(h.phone=d.value),g.value){let b=g.value.toLowerCase();h.relationship=g.value.toLowerCase(),this.plugin.settings.relationshipTypes.includes(b)||(this.plugin.settings.relationshipTypes=[...new Set(this.plugin.settings.relationshipTypes.filter(W=>W.toLowerCase()!==b)),b],this.plugin.saveSettings())}h.name&&(this.onSubmit(h),this.close())})}async onSubmit(t){let e=`${t.name}.md`,a=`${this.plugin.settings.contactsFolder}/${e}`,n=this.plugin.settings.contactsFolder;this.app.vault.getFolderByPath(n)||await this.app.vault.createFolder(n);let r=`---
${(0,at.stringifyYaml)(t)}
---
`;try{await this.app.vault.create(a,r),await new Promise(s=>setTimeout(s,300));let o=this.app.workspace.getLeavesOfType(v);for(let s of o){let l=s.view;if(l instanceof w){await l.refresh();break}}new A.Notice(this.plugin.t("created_contact")+": "+t.name)}catch(o){new A.Notice(this.plugin.t("error_creating_contact")+": "+o)}}onClose(){let{contentEl:t}=this;t.empty()}};var nt=require("obsidian"),P=class extends nt.Modal{constructor(t,e,a){super(t);this.file=e;this.onDelete=a}onOpen(){var r;let{contentEl:t}=this;t.empty();let e=this.app.plugins.getPlugin("collaborator-tracker");t.createEl("h2",{text:(e==null?void 0:e.t("delete_contact"))||"Delete contact"}),t.createEl("p",{text:((r=e==null?void 0:e.t("delete_confirm"))==null?void 0:r.replace("{name}",this.file.basename))||`Are you sure you want to delete ${this.file.basename}?`});let a=t.createEl("div",{cls:"collaborator-tracker-modal-buttons"});a.createEl("button",{text:(e==null?void 0:e.t("cancel"))||"Cancel",cls:"collaborator-tracker-modal-button"}).addEventListener("click",()=>this.close()),a.createEl("button",{text:(e==null?void 0:e.t("delete"))||"Delete",cls:"collaborator-tracker-modal-button collaborator-tracker-modal-button-danger"}).addEventListener("click",async()=>{await this.onDelete(),this.close()})}onClose(){let{contentEl:t}=this;t.empty()}};var v="collaborator-tracker-view",w=class extends L.ItemView{constructor(t,e){super(t);this.plugin=e;this.fileChangeHandler=null;this.isRefreshing=!1;this._contacts=null;this.searchQuery="";this.searchFocused=!1;this.searchInput=null;this.handleVisibilityChange=()=>{document.visibilityState==="visible"&&this.refresh()};this.handleWindowFocus=()=>{this.refresh()};this.currentSort={column:this.plugin.settings.defaultSortColumn,direction:this.plugin.settings.defaultSortDirection},this.tableView=new F(this),this.contactOps=new S(this.plugin)}async openAddContactModal(){new N(this.app,this.plugin).open()}handleSort(t){this.currentSort.column===t?this.currentSort.direction=this.currentSort.direction==="asc"?"desc":"asc":this.currentSort={column:t,direction:"asc"},this.refresh()}async openContact(t){let e=this.app.workspace.getLeavesOfType(D),a=e.length>0?e[0]:this.app.workspace.getLeaf("tab");await a.setViewState({type:D,state:{filePath:t.path}}),this.app.workspace.setActiveLeaf(a,{focus:!0}),this.app.workspace.revealLeaf(a),L.Platform.isMobile&&this.app.workspace.rightSplit.collapse()}async openDeleteModal(t){new P(this.app,t,async()=>{await this.app.fileManager.trashFile(t),await this.refresh()}).open()}updateSearchQuery(t){this.searchQuery=t,this.refresh()}getViewType(){return v}getDisplayText(){return"Collaborator Tracker"}async onOpen(){this.registerEvent(this.app.vault.on("modify",t=>{t instanceof L.TFile&&this.isContactFile(t)&&setTimeout(()=>this.refresh(),100)})),document.addEventListener("visibilitychange",this.handleVisibilityChange),window.addEventListener("focus",this.handleWindowFocus),await this.refresh()}onunload(){document.removeEventListener("visibilitychange",this.handleVisibilityChange),window.removeEventListener("focus",this.handleWindowFocus)}async refresh(){if(!this.isRefreshing){this.isRefreshing=!0;try{this._contacts=null;let t=this.containerEl.children[1];for(;t.firstChild;)t.removeChild(t.firstChild);let e=await this.contactOps.getContacts(),a=this.filterContacts(e),n=this.currentSort.column&&this.currentSort.direction?this.currentSort:{column:"name",direction:"asc"},i=a.sort((o,s)=>{let l=o[n.column],d=s[n.column];return l===null&&d===null?0:l===null?n.direction==="asc"?-1:1:d===null?n.direction==="asc"?1:-1:l<d?n.direction==="asc"?-1:1:l>d?n.direction==="asc"?1:-1:0}),r=t.createDiv();if(await this.tableView.render(r,i,n),this.searchFocused&&this.searchInput){let o=this.searchInput.value;this.searchInput.focus({preventScroll:!0}),this.searchInput.setSelectionRange(o.length,o.length)}}finally{this.isRefreshing=!1}}}isContactFile(t){let e=this.plugin.settings.contactsFolder;return t.path.startsWith(e+"/")}async sortContacts(t,e){this.currentSort={column:t,direction:e},await this.refresh()}filterContacts(t){if(!this.searchQuery)return t;let e=this.searchQuery.toLowerCase();return t.filter(a=>a.name.toLowerCase().includes(e))}};var y=require("obsidian"),j=class extends y.AbstractInputSuggest{constructor(t,e){super(t,e);this.inputEl=e}getSuggestions(t){return this.app.vault.getAllLoadedFiles().filter(a=>a instanceof y.TFolder).map(a=>a.path).filter(a=>a.toLowerCase().includes(t.toLowerCase()))}renderSuggestion(t,e){e.setText(t)}selectSuggestion(t){this.inputEl.value=t,this.inputEl.trigger("input"),this.close()}},H=class extends y.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty();let e=[{value:"name",label:"Name"},{value:"age",label:"Age"},{value:"birthday",label:"Birthday"},{value:"daysUntilBirthday",label:"Days until birthday"},{value:"relationship",label:"Relationship"},{value:"lastInteraction",label:"Last interaction"}];new y.Setting(t).setName("Contacts folder").setDesc("Folder where contact files will be stored").addText(i=>(new j(this.app,i.inputEl),i.setPlaceholder("Enter folder name").setValue(this.plugin.settings.contactsFolder).onChange(async r=>{this.plugin.settings.contactsFolder=(0,y.normalizePath)(r),await this.plugin.saveSettings()}))),new y.Setting(t).setName("Default sort").setDesc("Choose how contacts are sorted by default").addDropdown(i=>(e.forEach(({value:r,label:o})=>{i.addOption(r,o)}),i.setValue(this.plugin.settings.defaultSortColumn).onChange(async r=>{this.plugin.settings.defaultSortColumn=r,await this.plugin.saveSettings()}))).addDropdown(i=>{i.addOption("asc","Ascending").addOption("desc","Descending").setValue(this.plugin.settings.defaultSortDirection).onChange(async r=>{this.plugin.settings.defaultSortDirection=r,await this.plugin.saveSettings()})});let a=t.createEl("div",{cls:"collaborator-tracker-relationship-header"});a.createEl("h3",{text:"Relationship types"}),new y.Setting(a).addButton(i=>i.setButtonText("Add relationship type").onClick(async()=>{let r=document.createElement("input");r.type="text",r.placeholder="Enter relationship type",r.className="collaborator-tracker-modal-input relationship-type-input",i.buttonEl.replaceWith(r),r.focus();let o=async()=>{let l=(r.value||"").trim();if(l){let d=l.toLowerCase();this.plugin.settings.relationshipTypes.includes(d)||(this.plugin.settings.relationshipTypes.push(d),await this.plugin.saveSettings())}setTimeout(()=>this.display(),0)};r.addEventListener("keydown",async s=>{s.key==="Enter"?(s.preventDefault(),await o()):s.key==="Escape"&&this.display()}),r.addEventListener("blur",async()=>{var s;(s=r.value)!=null&&s.trim()?await o():this.display()})}));let n=t.createEl("div",{cls:"collaborator-tracker-relationship-types"});this.plugin.settings.relationshipTypes.forEach(i=>{new y.Setting(n).addText(r=>r.setValue(i).setPlaceholder("Type name").then(o=>{o.inputEl.addEventListener("keypress",async s=>{s.key==="Enter"&&(s.preventDefault(),o.inputEl.blur())}),o.inputEl.addEventListener("blur",async()=>{let s=o.inputEl.value,l=this.plugin.settings.relationshipTypes.indexOf(i);if(s.toLowerCase()!==i||s!==s.toLowerCase()){let d=s.toLowerCase();this.plugin.settings.relationshipTypes=[...this.plugin.settings.relationshipTypes.filter((u,g)=>g===l||u.toLowerCase()!==d)],this.plugin.settings.relationshipTypes[l]=d,await this.plugin.saveSettings(),setTimeout(()=>this.display(),0)}})})).addExtraButton(r=>{r.setIcon("trash").setTooltip("Delete relationship type").onClick(async()=>{let o=this.plugin.settings.relationshipTypes.indexOf(i);this.plugin.settings.relationshipTypes.splice(o,1),await this.plugin.saveSettings(),this.display()})})}),new y.Setting(t).setName("Default tab").setDesc("Choose which tab opens by default").addDropdown(i=>{i.addOption("notes","Notes").addOption("interactions","Interactions").addOption("markdown","Markdown").setValue(this.plugin.settings.defaultActiveTab).onChange(async r=>{this.plugin.settings.defaultActiveTab=r,await this.plugin.saveSettings()})}),new y.Setting(t).setName("Language").setDesc("Select plugin language").addDropdown(i=>{i.addOption("en","English").addOption("pt","Portugu\xEAs").addOption("zh","\u4E2D\u6587").addOption("ja","\u65E5\u672C\u8A9E").setValue(this.plugin.settings.language).onChange(async r=>{this.plugin.settings.language=r,await this.plugin.saveSettings(),await this.plugin.loadTranslations(),this.display()})})}};var V=class extends E.Plugin{constructor(){super(...arguments);this.translations={}}t(t){return this.translations[t]||t}async onload(){await this.loadSettings(),await this.loadTranslations(),this.contactOperations=new S(this),this.app.workspace.onLayoutReady(()=>{this.initialize()})}async initialize(){try{this.registerView(v,t=>new w(t,this)),this.registerView(D,t=>new R(t,this)),this.addRibbonIcon("user","Open Collaborator Tracker",async()=>{let t=this.app.workspace,e=t.getLeavesOfType(v);for(let n of e)if(await n.view instanceof w){t.revealLeaf(n);return}let a=t.getRightLeaf(!1);a?(await a.setViewState({type:v,active:!0}),t.revealLeaf(a)):new E.Notice("Could not create Collaborator Tracker view")}),this.addSettingTab(new H(this.app,this)),await this.checkBirthdays()}catch(t){console.error("Collaborator Tracker failed to load:",t),new E.Notice("Collaborator Tracker failed to load: "+t.message)}}async checkBirthdays(){let t=await this.contactOperations.getContacts(),e=t.filter(n=>n.daysUntilBirthday===0);if(e.length>0)if(e.length===1)new E.Notice(`\u{1F382} It's ${e[0].name}'s birthday today!`,8e3);else{let n=e.map(o=>o.name),i=n.pop(),r=n.join(", ")+" and "+i;new E.Notice(`\u{1F382} It's ${r}'s birthday today!`,8e3)}let a=t.filter(n=>n.daysUntilBirthday===1);if(a.length>0)if(a.length===1)new E.Notice(`\u{1F388} ${a[0].name}'s birthday is tomorrow!`,6e3);else{let n=a.map(o=>o.name),i=n.pop(),r=n.join(", ")+" and "+i;new E.Notice(`\u{1F388} ${r}'s birthdays are tomorrow!`,6e3)}}async loadTranslations(){try{let e=`${X(this.app,this.manifest)}/locales/${this.settings.language}.ini`;this.translations=await Z(e)}catch(t){console.error("Failed to load translations",t),this.translations={}}}async loadSettings(){this.settings=Object.assign({},K,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async onunload(){let t=document.getElementById("relationship-types");t&&t.remove()}};
